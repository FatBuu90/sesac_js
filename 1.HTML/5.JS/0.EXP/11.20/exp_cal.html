<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <style>
        body{
            margin: 0 auto;
            padding: 0;
            height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        div{
            border: 1px solid black;
            height: 70px;
        }
        .cal_container{
            display: grid;
            width: 400px;
            height: 400px;
            grid-template-rows: 1fr 4fr;
            gap: 5px;
            border: none;
        }
        .car_grid{
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 5px;
            border: none;
        }
        .car_grid div{
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 25px;
            background-color: rgb(236, 236, 236);
        }
        .car_grid div:hover{
            cursor: pointer;
        }
        .car_grid div:active{
            transform: scale(0.95);
        }
        #result_area{
            text-align: right;
            font-size: 30px;
            padding-right: 10px;
            height: 80px;
        }
        .disabled{
            pointer-events: none;
            opacity: 0.5;
            color: gray;
        }
    </style>
</head>
<body>
    
    <div class="cal_container">
        <input id="result_area" type="text"/>
        <div class="car_grid">
            <div onclick="clickBtn('+')">+</div>
            <div onclick="clickBtn('-')">-</div>
            <div onclick="clickBtn('*')">*</div>
            <div onclick="clickBtn('/')">/</div>

            <div onclick="clickBtn('7')">7</div>
            <div onclick="clickBtn('8')">8</div>
            <div onclick="clickBtn('9')">9</div>
            <div onclick="clickBtn_result()">=</div>

            <div onclick="clickBtn('4')">4</div>
            <div onclick="clickBtn('5')">5</div>
            <div onclick="clickBtn('6')">6</div>
            <div onclick="clickBtn_Reset()">C</div>

            <div onclick="clickBtn('1')">1</div>
            <div onclick="clickBtn('2')">2</div>
            <div onclick="clickBtn('3')">3</div>
            <div id="btnZero" onclick="clickBtn('0')">0</div>
        </div>
    </div>
    <script>
        let result_input = document.getElementById("result_area");
        let text = "";

        function filter_Input(input) {
            let raw = input.target.value;
            let filtered = raw.replace(/[^0-9+\-*/]/g, '');

            if (raw !== filtered) {
                input.target.value = filtered;
            }
            text = filtered;

            // 키보드로 '/' 입력했을 때도 0 버튼 비활성화
            var zero = document.getElementById("btnZero");
            var last = filtered.slice(-1);
            if (last === '/') {
                zero.classList.add('disabled');
            } else {
                zero.classList.remove('disabled');
            }
        }
        result_input.addEventListener("input", filter_Input);

        function handleKeyDown(e) {
            // = 키로 계산
            if (e.key === '=') {
                e.preventDefault();      // = 글자가 인풋에 찍히는 거 방지
                clickBtn_result();       // 기존 = 버튼 함수 호출
            }

            // Enter도 =처럼 동작하게 하고 싶으면
            if (e.key === 'Enter') {
                e.preventDefault();
                clickBtn_result();
            }
        }
        result_input.addEventListener("keydown", handleKeyDown);

        function isOperator(ch) {
            return ['+', '-', '*', '/'].includes(ch);
        }
        function clickBtn(btn){
            let zero = document.getElementById("btnZero");
            let cur = result_input.value;
            let last = cur.slice(-1);

            // 1. 맨 처음에 연산자 못 오게
            if (!cur && isOperator(btn)) {
                return;
            }

            // 2. 연산자 중복 입력 막기 (두 번째 연산자는 무시)
            if (isOperator(btn) && isOperator(last)) {
                return;
            }

            // 3. 실제로 문자 추가
            text = cur + btn;
            result_input.value = text;
            
            // 4. 마지막 문자가 '/'일 때만 0 버튼 비활성화
            const newLast = text.slice(-1);
            if (newLast === '/') {
                zero.classList.add('disabled');
            } else {
                zero.classList.remove('disabled');
            }

        }

        function clickBtn_Reset(){
            text = "";
            result_input.value = text;
            document.getElementById("btnZero").classList.remove('disabled');
        }

        function clickBtn_result(){
            let nums = result_input.value.split(/[+\-*/]/).map(Number);
            let tokens = result_input.value.match(/[+\-*/]/g);
            let result = nums[0];
            for(let i = 0; i < tokens.length; i++){
                if(tokens[i] == '+'){
                    result += nums[i+1];
                }else if(tokens[i] == '-'){
                    result -= nums[i+1];
                }else if(tokens[i] == '*'){
                    result *= nums[i+1];
                }else if(tokens[i] == '/'){
                    result /= nums[i+1];
                }
            }
            text = result;
            result_input.value = text;
        }

        // 예상되는 첫 번째 버그 
        // 연산자를 중복해서 입력했을 때, 연산자와 연산자 사이의 값이 없어 오류 발생
        // 해결방법         
        // 1. 연산자를 중복으로 누르지 못하게 막는다. (1번 선택)
        // 2. 이미 입력된 연산자를 새 연산자로 변경한다.

        // 예상되는 두 번째 버그
        // 입력한 값을 0으로 나누었을 때 발생하는 오류
        // 해결방법
        // 1. 나누기 부호 바로 뒤에는 0 버튼을 누를 수 없게 비활성화 한다. (1번 선택)

        // 예상되는 세 번째 버그
        // input type="text"로 열려있기 때문에 값을 키보드로 입력할 수 있다.
        // 키보드로 입력할 때 숫자나 부호가 아닌 알파벳이 입력될 수 있다.
        // 해결방법
        // 1. 값이 입력될 때 숫자와 부호를 제외한 값은 무시한다. (1번 선택)

        // 예상되는 네 번째 버그
        // 마지막에 입력한 값이 연산자 일 때 = 을 누를 수 있다.
        // +, - 의 경우 연산자를 무시해버리고 *, / 의 경우 0으로 곱하거나 나눈걸로 취급된다.
        // 해결방법
        // 1. 마지막에 입력한 값이 연산자 일 때 = 키를 비활성화 한다. (1번 선택)
        // 2. 윈도우 계산기처럼 마지막에 계산된 값과 동일한 값으로 처리한다.

        // 예상되는 다섯 번째 버그
        // 시작 값이 숫자가 아니라 연산자로 시작할 수 있다.
        // 해결방법
        // 1. 입력된 숫자 값이 없을 때 연산자 클릭을 무시한다. (1번 선택)
        // 2. 처음 입력된 값을 0으로 지정하고 계산 처리를 한다.
    </script>
</body>
</html>